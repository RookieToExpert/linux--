# vim和vi
> vim可以理解为vi的进阶版，vim是一个程序开发工具而不仅仅是一个程序开发工具

## vi的使用
---
### 三种模式：
- *一般指令模式(**command mode**)*:
    - (默认的模式)，可以上下左右移动光标。
    - 可以**删除字符/整列**或者**复制以及粘贴文件数据**。
    - **不能编辑**文件内容。

- *编辑模式(**insert mode**)*：
    - 左上角出现**INSERT或者REPLACE**表明进入编辑模式。
    - **可以编辑**文件内容。
- *命令行命令模式(**command-line mode**)*：
    - 光标移动到**最下面那一列**表示进入命令行命令模式。
    - 可以搜索数据，读取、存大量取代字符、离开vi等动作。

**模型图：**

![0](/img/11Chapter/Capture.PNG)

---
### 进入vi方式：
```Shell
[ray@CentOSTest tmp]$ vi ./testfile
```
*output：*
新文件会显示**new file**，保存后就会创建此文件

![0](/img/11Chapter/Capture1.PNG)

> 已存在的文件会显示**行数和字符数**

![0](/img/11Chapter/Capture2.PNG)

---
### vi中一些常见按键：
#### 一般模式：
1. 如何进入**编辑模式**：
按下 **"i, o, a"** 就可以进入编辑模式，左下角会出现-- INSERT --，按 **"esc"** 可以退出编辑模式回到一般指令模式
2. 如何**退出vi**：
回到一般指令模式，输入 **:wq** 保存并退出，或者输入 **:q!** 不保存退出。
> 但是如果你的文件没有**w**的权限，则可以使用 **:wq!** 强行保存，但前提是文件是可以改变权限的
3. 其他：
- _**光标在列之间移动**_：

    向左: **h**

    向右：**l**

    向下：**j**

    向上：**k**

    上下左右的按键也可以实现移动光标，但是hjkl可以批量移动，比如输入30j就是往下移动30次光标

    |**H**|光标移动到这个屏幕的**最上方那一列的第一个字符**

    |**M**|光标移动到这个屏幕的**中央那一列的第一个字符**

    |**L**|光标移动到这个屏幕的**最下方那一列的第一个字符**

    |**G**|移动到这个**文件的最后一列**（常用）

    |**nG**|n 为数字。**移动到这个文件的第 n 列**。例如 20G 则会移动到这个文件的第 20 列（可配合 :set nu）

    |**gg**|移动到这个文件的第一列，**相当于 1G** 啊！ （常用）

    |n<Enter>|n 为数字。光标**向下移动 n 列并且光标回到开头**（常用）

    |**+**|光标移动到**下一列**(等同于enter)

    |**-**|光标移动到**上一列**
---
- **_翻页_**：

    向下移动一页：[ctrl] + [f],相当于[Page Down]

    向上移动一页：[ctrl] + [b]相当于[Page Up]

    向下移动半页：[ctrl] + [d]

    向上移动半页：[ctrl] + [u]
---
- **_光标左右移动：_**

    |**n + [space]**|那个 n 表示“数字”，例如 20 。按下数字后再按空白键，光标会**向右移动这一列的 n 个字符**。例如 20 + [space] 则光标会向后面移动 20 个字符距离。

    |**0 或功能键[Home]**|这是数字“ 0 ”：移动到这**一列的最前面字符处** （常用）

    |**\$ 或功能键[End]**|移动到这**一列的最后面字符处**（常用）
---
- **_搜寻与取代_**：

    |**/word**|向光标之**下寻找一个名称为 word** 的字串。例如要在文件内搜寻 vbird 这个字串，就输入 /vbird 即可！ （常用）

    |**?word**|向光标之**上寻找一个字串名称为 word** 的字串。

    |**n**|这个 n 是英文按键。代表“<u>重复前一个搜寻的动作</u>”。举例来说， 如果刚刚我们执行 /vbird 去向下搜寻 vbird 这个字串，则按下 n 后，会向下继续搜寻下一个名称为 vbird 的字串。如果是执行 ?vbird 的话，那么按下 n 则会向上继续搜寻名称为 vbird 的字串！

    |**N**|这个 N 是英文按键。与 n 刚好相反，为 **“反向”进行前一个搜寻动作**。 例如 /vbird 后，按下 N 则表示“向上”搜寻 vbird 。

    |使用 **/word 配合 n 及 N** 是非常有帮助的！可以让你重复的找到一些你搜寻的关键字！

    |**:n1,n2s/word1/word2/g**|n1 与 n2 为数字。在第 **n1 与 n2 列之间寻找 word1** 这个字串，**并将该字串取代为 word2** ！举例来说，在 100 到 200 列之间搜寻 vbird 并取代为 VBIRD 则：“:100,200s/vbird/VBIRD/g”。（常用）

    |**:1,\$s/word1/word2/g**|从**第一列到最后一列**寻找 word1 字串，并将该字串**取代**为 word2 ！（常用）

    |**:1,\$s/word1/word2/gc**|从**第一列到最后一列**寻找 word1 字串，并将该字串**取代**为 word2 ！且在取代前显示提示字符给使用者确认 **（confirm）** 是否需要取代！（常用）
---
- **_删除_**：
    |**x, X**|在一列字当中，x 为向**光标后删除**一个字符 （相当于 [del] 按键）， X 为向**光标前删除**一个字符（相当于 [backspace] 亦即是倒退键） （常用）

    |**nx**|n 为数字，**连续向后删除 n 个字符**。举例来说，我要连续删除 10 个字符， “10x”。

    |**dd**|**删除**光标所在的那**一整列**（常用）

    |**ndd**|n 为数字。**删除光标所在的向下 n 列**，例如 20dd 则是删除 20 列 （常用）

    |**d1G**|**删除**光标**所在到第一列的所有数据**

    |**dG**|**删除**光标**所在到最后一列的所有数据**

    |**d\$**|**删除**光标所在处，**到**该列的**最后一个字符**

    |**d0**|那个是数字的 0 ，**删除**光标所在处，**到**该列的**最前面一个字符**
---
- **_复制与贴上_**：

    |**yy**|**复制**光标**所在的那一列**（常用）

    |**nyy**|n 为数字。**复制**光标**所在的向下 n 列**，例如 20yy 则是复制 20 列（常用）

    |**y1G**|**复制**光标**所在列到第一列**的所有数据

    |**yG**|**复制**光标**所在列到最后一列**的所有数据

    |**y0**|**复制**光标所在的那个**字符到该列行首**的所有数据

    |**y$**|**复制**光标所在的那个**字符到该列行尾**的所有数据

    |**p, P**|**p** 为将已复制的数据在光标**下一列贴上**，**P** 则为**贴在光标上一列**！ 举例来说，我目前光标在第 20 列，且已经复制了 10 列数据。则按下 p 后， 那 10 列数据会贴在原本的 20 列之后，亦即由 21 列开始贴。但如果是按下 P 呢？ 那么原本的第 20 列会被推到变成 30 列。 （常用）
---
- **_其他常用_**：

    |**J**|将光标**所在列与下一列的数据结合成同一列**

    |**c**|重复删除多个数据，例如向**下删除 10 列**，[ **10cj** ]

    |**u**|**撤回前一个动作**。（常用）

    |**[Ctrl]+r**|**恢复被u撤回的动作**。（常用）

    |这个 u 与 [Ctrl]+r 是很常用的指令！一个是复原，另一个则是重做一次～ 利用这两个功能按键，你的编辑，嘿嘿！很快乐的啦！

    |**.**|不要怀疑！这就是小数点！意思是**重复前一个动作的意思**。 如果你想要重复删除、重复贴上等等动作，按下小数点“.”就好了！ （常用）

---
#### 一般指令模式切换到编辑模式
- **—进入插入或取代的编辑模式—：**

    |**i, I**|进入插入模式（**Insert mode**）：**i** 为“从**目前光标**所在处**插入**”， I 为“在目前**所在列的第一个非空白字符**处开始**插入**”。 （常用）

    |**a, A**|进入插入模式（**Insert mode**）：**a** 为“从目前光标所在的**下一个字符**处开始**插入**”， **A** 为“从光标**所在列的最后一个字符**处开始**插入**”。（常用）

    |**o, O**|进入插入模式（**Insert mod**e）：这是英文字母 o 的大小写。**o** 为“在目前光标所在的**下一列处插入新的一列**”； O 为在目前光标所在处的**上一列插入新的一列**！（常用）

    |**r, R**|进入取代模式（**Replace mode**）：**r** 只会取代光标**所在的那一个字符一次**；**R**会**一直取代光标所在的文字**，直到按下 **ESC** 为止；（常用）
    |上面这些按键中，在 vi 画面的左下角处会出现“—INSERT—”或“—REPLACE—”的字样。 由名称就知道该动作了吧！！特别注意的是，我们上面也提过了，你想要在文件里面输入字符时， 一定要在左下角处看到 INSERT 或 REPLACE 才能输入喔！

    |[**Esc**]|退出编辑模式，**回到一般指令模式中**（常用）

---
#### 一般指令模式切换到命令行界面
- **_命令行界面的储存、离开等指令：_**

    |**:w**|将编辑的数据**写入硬盘文件**中（常用）

    |**:w!**|若文件属性为“**只读**”时，**强制写入**该文件。不过，到底能不能写入， 还是跟你对**该文件的文件权限有关**啊！

    |**:q**|离开 vi （常用）

    |**:q!**|若曾修改过文件，又不想储存，使用 ! 为**强制离开不储存文件**。
    |注意一下啊，那个惊叹号 （**!**） 在 vi 当中，常常具有“**强制**”的意思～

    |**:wq**|**储存后离开**，若为 **:wq!** 则为**强制储存后离开** （常用）

    |**ZZ**|这是大写的 Z 喔！若文件**没有更动**，则**不储存离开**，若文件已经**被更动过**，则**储存后离开**！
    
    |**:w [filename]**|将编辑的数据**储存成另一个文件**（类似另存新文件）
    
    |**:r [filename]**|在编辑的数据中，**读入另一个文件的数据**。亦即将 “filename” 这个**文件内容加到光标所在列后面**

    |**:n1,n2 w [filename]**|将 **n1 到 n2 的内容储存成 filename** 这个文件。

    |**:! command**|**暂时离开 vi** 到命令行界面下执行 command 的显示结果！例如 “**:! ls /home**”即可在 **vi 当中察看 /home** 下面以 ls 输出的文件信息！

- **_vim 环境的变更：_**

    |**:set nu**|**显示行号**，设置之后，会在每一列的字首显示该列的行号

    |**:set nonu**|与 set nu 相反，为**取消行号**！


## vim暂存盘、救援回复与打开时的警告讯息

> vim会在与被编辑的文件的目录下，创建一个名为.filename.swp的文件，可以用此文件来进行recovery

**_使用方法：_**

```Shell
[ray@CentOSTest vitest]$ vim man_db.conf 
#按crtl z退出vim，但后台任然在运行vim
[1]+  Stopped                 vim man_db.conf
#可以看到man_db.conf.swp这个文件
[ray@CentOSTest vitest]$ ls -al
total 28
drwxrwxr-x.  2 ray  ray     49 Dec  2 07:04 .
drwxrwxrwt. 13 root root  4096 Dec  2 07:04 ..
-rw-r--r--.  1 ray  ray   4573 Dec  2 06:59 man_db.conf
-rw-r--r--.  1 ray  ray  16384 Dec  2 07:04 .man_db.conf.swp
#杀死vim这个程序，模仿中途死机
[ray@CentOSTest vitest]$ kill -9 %1

[1]+  Stopped                 vim man_db.conf
#再次进入vim，就会有以下提示
[ray@CentOSTest vitest]$ vim man_db.conf 
```
![0](/img/11Chapter/Capture3.PNG)

六个按钮说明：
- [**O**]pen Read-Only：开启**只读模式**

- [**E**]dit anyway：还是用正常的方式打开你要编辑的那个文件， 并**不会载入暂存盘的内容**。
- [**R**]ecover：就是**载入暂存盘的内容**，用在你要救回之前未储存的工作。 不过当你救回来并且储存离开 vim 后，还是要**手动自行删除那个暂存盘**喔！

- [**D**]elete it：你确定那个暂存盘是无用的！那么**打开文件前会先将这个暂存盘删除**。

- [**Q**]uit：按下 q 就离开 vim ，**不会进行任何动作回到命令提示字符**。

- [**A**]bort：忽略这个编辑行为，感觉上与 quit 非常类似！ 也会**送你回到命令提示字符**。