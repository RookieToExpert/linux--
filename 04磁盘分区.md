# 磁盘连接方式和设备文件名的关系

> 磁盘示意图
![00](/img/04Chapter/Capture.PNG)
- __sector__:
最小单位，每段圆弧叫做扇区
- __cylinder__:
同一个方位上的所有platter的扇区组成一个柱面
- __track__:
磁道，同心圆轨迹叫做磁道
- __platter__:
一块硬盘有若干盘片，每个盘片都有可以存储数据的上线两盘面(Side)
- __head__:
磁头，盘面号即磁头号

> 定位时，首先确定柱面，再确定盘面，最后确定扇区

目前分区表有两种格式：
#### MSDOS(MBR)分区表格式与限制
- __开机记录区__(Master Boot Record, MBR)
记录在第一个扇区，通常是512Bytes：
    - 主要开机记录区，可以安装开机管路程序的地方，有446Bytes
    - 分区表(partition table):记录整颗硬盘分区状态
    ![01](/img/04Chapter/Capture2.PNG)
    >假如硬盘设备文件名为/dev/sda，那么这四个分区在linux设备文件名会如下：
        - P1:/dev/sda1
        - P2:/dev/sda2
        - P3:/dev/sda3
        - P4:/dev/sda4

但实际上磁盘不可能只有四块分区，所以分为:
- __主分区__(Primary Partition):
MBR中，一块硬盘最多只能有4个主分区
- __扩展分区__(Extended Partition):
扩展分区本身并不直接存储数据，而是作为容器或者占位符，允许创建多个逻辑分区。
![02](/img/04Chapter/Capture3.PNG)
> PS:sd1-sd4是留给主分区，所以拓展分区是从sd5开始

_如果想要将两个分区合成一个新的分区，需要判断它们是否属于主分区还是逻辑分区，如果处在不同地区，那么需要将拓展分区破坏掉再重新分区。_

> - 由于MBR内的开放管理程序区块仅446Bytes，无法容纳较多的程序码，就会导致无法抓取2.2T以上的磁盘容量。
> - 并且由于MBR仅有一个区块，若被破坏后，经常无法或者很难救援

如此，GUID partition table GPT就出现了

#### GUID partition磁盘分区格式
- __Logical Block Address(LBA逻辑区块位址)__
    - GPT不在使用扇区来定义，而是用**LBA**定义
    - 一个LBA默认为512Bytes
    - 第一个LBA称为LBA0(__从0开始__)
    - 使用**前34个LBA**区块记录分区信息，并且**最后33个LBA区块**用作备份
    ![03](/img/04Chapter/Capture4.PNG)
    > - LBA0(MBR相容区块)
    >   - 也有**446Bytes**相似的区块，放置**开机管理程序**
    >   - 另一块仅放入一个**特殊标志表示此磁盘为GPT**
    > - LBA1(GPT表头记录)
    >   - 记录**分区表本身**的**位置与大小**
    >   - 同时记录**备份用的GPT分区**
    > - LBA2-33(**实际记录分区信息处**)
    >   - 每个LBA记录4笔分区记录，总过可以记**4*32=128**笔分区记录
    >   - 每个LBA都是**主分区**

#### 开机检测程序BIOS与UEFI
_开机前计算机并没有任何软件系统，如何读取硬盘内的操作系统文件？这就要涉及到开机程序了_
- __BIOS__：
> _之前提到CMOS，是记录各项硬件参数并且嵌入在主板上的储存器_
- 分割
    - BIOS是写入到主板的固件(硬件的软件程序)，是计算机系统**主动执行的第一个程序**
    - BIOS会去**识别开机设备的第一个扇区/LBA**并读取**开机管理程序码**(开机管理程序是操作系统在安装时候提供的)
    - 开机管理程序(boot loader)可以**读取核心文件来执行的软件**
    - **核心文件**会开始操作系统的功能

- __UEFI__:
*Extensible Firmware Interface*
*由于UEFI支持的分区，/boot目录几乎都是从/dev/sda3之后的号码开始*
![04](/img/04Chapter/Capture5.PNG)

#### Liunx磁盘分区
- 目录树结构(directory tree)
![05](/img/04Chapter/Capture6.PNG)
磁盘分区的数据放在不同目录下：
![06](/img/04Chapter/Capture7.PNG)